<div class="create-assessment-bg mt-4">
  <div class="create-assessment-card">
    <!-- Header Section -->
    <div class="text-center mb-4">
      <div class="brand-icon">
        <i class="fas fa-clipboard-list"></i>
      </div>
      <h1 class="brand-heading mb-2">Create Assessment</h1>
      <p class="brand-subheading">Design structured evaluation processes for your hiring workflow</p>
    </div>

    <!-- Assessment Title Section -->
    <div class="mb-4">
      <label for="assessmentTitle" class="form-label">Assessment Title</label>
      <input 
        type="text" 
        id="assessmentTitle"
        class="form-control" 
        [(ngModel)]="assessmentTitle"
        placeholder="Enter assessment title..."
        [class.is-invalid]="error && !assessmentTitle.trim()">
    </div>

    <!-- Steps Section -->
    <div class="mb-4">
      <h5 class="mb-3">Assessment Steps</h5>
      
      <div 
        *ngFor="let step of steps; let i = index; trackBy: trackByIndex" 
        class="step-card-wrapper">
        
        <!-- Delete Button (only show if more than 1 step) -->
        <button 
          *ngIf="steps.length > 1"
          type="button" 
          class="step-delete-btn"
          (click)="removeStep(i)"
          title="Remove step">
          <i class="fas fa-times"></i>
        </button>

        <div class="step-card">
          <div class="step-content">
            <!-- Step Number Column -->
            <div class="step-number-col d-flex flex-column align-items-center justify-content-center">
              <span class="step-number-label mb-2">Step</span>
              <span class="step-number-display">{{ i + 1 }}</span>
            </div>

            <!-- Main Content -->
            <div class="step-main-row">
              <div class="step-inputs-col">
                <!-- Step Name Dropdown -->
                <div class="input-group">
                  <label class="form-label">Step Name</label>
                  <div class="custom-dropdown-wrapper">
                    <input 
                      type="text" 
                      class="form-control custom-dropdown-input"
                      [(ngModel)]="step.stepName"
                      (focus)="toggleStepDropdown(i, true)"
                      (input)="filterStepOptions($event, i)"
                      placeholder="Select or type step name..."
                      autocomplete="off">
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                    <div class="custom-dropdown-menu" [class.show]="activeStepDropdown === i">
                      <div 
                        *ngFor="let option of getFilteredStepOptions(i)" 
                        class="dropdown-option"
                        (click)="selectStepOption(option, i)">
                        {{ option }}
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Mode Dropdown -->
                <div class="input-group">
                  <label class="form-label">Mode</label>
                  <div class="custom-dropdown-wrapper">
                    <input 
                      type="text" 
                      class="form-control custom-dropdown-input"
                      [(ngModel)]="step.mode"
                      (focus)="toggleModeDropdown(i, true)"
                      (input)="filterModeOptions($event, i)"
                      placeholder="Select mode..."
                      autocomplete="off">
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                    <div class="custom-dropdown-menu" [class.show]="activeModeDropdown === i">
                      <div 
                        *ngFor="let option of getFilteredModeOptions(i)" 
                        class="dropdown-option"
                        (click)="selectModeOption(option, i)">
                        {{ option }}
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Pass % -->
                <div class="input-group">
                  <label class="form-label">Pass %</label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="step.passingCriteria"
                    placeholder="70"
                    min="0" 
                    max="100">
                </div>
              </div>
              <!-- Centered Arrow Controls -->
              <div class="step-arrows-center">
                <button 
                  type="button" 
                  class="step-arrow-btn"
                  (click)="moveStepUp(i)"
                  [disabled]="i === 0"
                  title="Move step up">
                  <i class="fas fa-chevron-up"></i>
                </button>
                <button 
                  type="button" 
                  class="step-arrow-btn"
                  (click)="moveStepDown(i)"
                  [disabled]="i === steps.length - 1"
                  title="Move step down">
                  <i class="fas fa-chevron-down"></i>
                </button>
              </div>
            </div>
          </div>
          <!-- Move interviewer and feedback below all fields -->
          <div class="step-secondary-row mt-4 d-flex gap-4">
            <!-- Interviewer Name Dropdown (only show when mode is Manual) -->
            <div class="input-group" *ngIf="step.mode === 'Manual'">
              <label class="form-label">Interviewer Name</label>
              <div class="custom-dropdown-wrapper">
                <input 
                  type="text" 
                  class="form-control custom-dropdown-input"
                  [(ngModel)]="step.interviewerName"
                  (focus)="toggleInterviewerDropdown(i, true)"
                  (input)="filterInterviewerOptions($event, i)"
                  placeholder="Select interviewer..."
                  autocomplete="off">
                <i class="fas fa-chevron-down dropdown-arrow"></i>
                <div class="custom-dropdown-menu" [class.show]="activeInterviewerDropdown === i">
                  <div 
                    *ngFor="let option of getFilteredInterviewerOptions(i)" 
                    class="dropdown-option"
                    (click)="selectInterviewerOption(option, i)">
                    {{ option }}
                  </div>
                </div>
              </div>
            </div>
            <div class="feedback-group">
              <label for="feedback_{{ i }}">
                <input 
                  type="checkbox" 
                  id="feedback_{{ i }}"
                  [(ngModel)]="step.sendFeedback">
                Send feedback to applicants
              </label>
              <span class="feedback-description">
                Enables automatic feedback delivery to candidates for this assessment step
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Step Button -->
    <div class="text-center mb-4">
      <button 
        type="button" 
        class="btn brand-outline-btn px-4"
        (click)="addStep()">
        <i class="fas fa-plus me-2"></i>Add Another Step
      </button>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
    </div>

    <!-- Success Message -->
    <div *ngIf="success" class="alert alert-success" role="alert">
      <i class="fas fa-check-circle me-2"></i>Assessment created successfully!
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-between">
      <button 
        type="button" 
        class="btn brand-outline-btn px-4"
        routerLink="/assessments">
        <i class="fas fa-arrow-left me-2"></i>Back to Assessments
      </button>
      
      <button 
        type="button" 
        class="btn brand-green-btn px-4"
        (click)="submit()"
        [disabled]="loading">
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
        <i *ngIf="!loading" class="fas fa-save me-2"></i>
        {{ loading ? 'Creating...' : 'Create Assessment' }}
      </button>
    </div>
  </div>
</div>